<!--
Meta Description: # حدث onpopstate في جافا سكريبت: كيفية استخدامه في إدارة تاريخ المتصفح ## ملخص يعد حدث `onpopstate` في جافا سكريبت أحد الأحداث المهمة التي تتعلق بإدار...
Meta Keywords: onpopstate, page, event, حالة, على
-->

# حدث onpopstate في جافا سكريبت: كيفية استخدامه في إدارة تاريخ المتصفح

## ملخص
يعد حدث `onpopstate` في جافا سكريبت أحد الأحداث المهمة التي تتعلق بإدارة تاريخ المتصفح، حيث يتم تفعيل هذا الحدث عند تغيير حالة التاريخ في واجهة المستخدم.

## الوثائق
### الغرض
يتم استخدام حدث `onpopstate` للاستجابة لتغييرات حالة التاريخ في تطبيقات الويب التي تستخدم واجهة برمجة تطبيقات التاريخ (History API). يتيح لك هذا الحدث التعامل مع التغييرات التي تحدث عند العودة أو التقدم في سجل المتصفح.

### الاستخدام
يتم تعيين `onpopstate` كحدث على كائن `window`. يمكنك إضافة وظيفة معالجة (event handler) يتم استدعاؤها عندما يتغير تاريخ الحالة.

```javascript
window.onpopstate = function(event) {
    // كود للتعامل مع تاريخ الحالة
};
```

### التفاصيل
- **الحدث**: يتم إطلاق `onpopstate` فقط عند استرجاع حالة تم تخزينها بواسطة `history.pushState()` أو `history.replaceState()`.
- **الحدث**: يحتوي كائن الحدث على خاصية `state` التي تحتوي على البيانات المرتبطة بالحالة التي تم استرجاعها.
- **الاستخدام الشائع**: يتم استخدام `onpopstate` بشكل شائع في تطبيقات الـ SPA (Single Page Applications) لتحديث المحتوى عند تنقل المستخدم في سجل التاريخ.

## الأمثلة
### مثال أساسي
```javascript
// إضافة حالة جديدة إلى التاريخ
history.pushState({ page: 1 }, "title 1", "?page=1");

// تعيين حدث onpopstate
window.onpopstate = function(event) {
    if (event.state) {
        console.log("تم استرجاع الحالة:", event.state);
    } else {
        console.log("لا توجد حالة مرتبطة.");
    }
};
```

### استخدام مع تطبيق SPA
```javascript
// تغيير الحالة
function navigate(page) {
    history.pushState({ page: page }, "title " + page, "?page=" + page);
    // تحديث المحتوى هنا بناءً على الصفحة
}

// تعيين حدث onpopstate
window.onpopstate = function(event) {
    if (event.state) {
        // تحديث المحتوى بناءً على الحالة
        console.log("تم العودة إلى الصفحة:", event.state.page);
    }
};

// مثال على التنقل
navigate(2);
```

## الشرح
### الأخطاء الشائعة
- **عدم وجود حالة**: إذا تم استدعاء `onpopstate` قبل إضافة حالة بواسطة `pushState` أو `replaceState`، فإن `event.state` سيكون `null`.
- **التعامل مع التحديثات المتعددة**: تأكد من تحديث المحتوى بشكل صحيح عند استرجاع الحالة، حيث قد يؤدي عدم القيام بذلك إلى تجربة مستخدم غير متسقة.

### ملاحظات إضافية
- قد يكون `onpopstate` غير متاح في بعض المتصفحات القديمة، لذا تحقق من توافق المتصفح.
- يجب أن تكون حذرًا عند استخدام `pushState` و`replaceState` لتجنب إنشاء تاريخ مضطرب.

## ملخص من جملة واحدة
يستخدم حدث `onpopstate` في جافا سكريبت للاستجابة لتغييرات حالة التاريخ، مما يسمح بتحديث المحتوى بناءً على تنقل المستخدم بين الصفحات.