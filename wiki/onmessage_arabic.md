<!--
Meta Description: # onmessage في جافاسكريبت: كيفية التعامل مع الرسائل بين الـ Web Workers ## ملخص `onmessage` هو حدث في جافاسكريبت يُستخدم في بيئات الـ Web Workers للتع...
Meta Keywords: worker, onmessage, الـ, الرسائل, workers
-->

# onmessage في جافاسكريبت: كيفية التعامل مع الرسائل بين الـ Web Workers

## ملخص
`onmessage` هو حدث في جافاسكريبت يُستخدم في بيئات الـ Web Workers للتعامل مع الرسائل المرسلة من وإلى الـ Workers. يتيح هذا الحدث تنفيذ عمليات معينة عند استلام رسالة من الـ Worker أو إرسال رسالة إليه.

## الوثائق
### الغرض
يُستخدم `onmessage` للاستماع إلى الرسائل المرسلة من الـ Workers. عند استلام رسالة، يتم استدعاء الدالة المعرّفة في هذا الحدث، مما يسمح للمطورين بتنفيذ أكواد معينة بناءً على محتوى الرسالة.

### الاستخدام
يمكن استخدام `onmessage` في سياق الـ Web Workers كما يلي:

1. **إنشاء Worker**: أولاً، يجب عليك إنشاء Worker باستخدام الكود `new Worker('worker.js')`.
2. **تعيين `onmessage`**: بعد ذلك، يمكنك تعيين دالة `onmessage` على الـ Worker للاستجابة للرسائل.

### التفاصيل
- يتم استدعاء `onmessage` عندما يتم إرسال رسالة باستخدام `postMessage`.
- الرسالة المستلمة يتم تمريرها ككائن `MessageEvent`، والذي يحتوي على خاصية `data` تحتوي على بيانات الرسالة.
- يمكنك أيضًا استخدام `postMessage` لإرسال الرسائل من الـ Worker إلى الصفحة الرئيسية.

## الأمثلة
### مثال 1: إرسال رسالة من الصفحة الرئيسية إلى Worker
```javascript
// في الملف الرئيسي
const worker = new Worker('worker.js');

worker.onmessage = function(event) {
    console.log('Received from worker:', event.data);
};

worker.postMessage('Hello, Worker!');
```

### مثال 2: استقبال رسالة في Worker
```javascript
// في worker.js
onmessage = function(event) {
    console.log('Message from main script:', event.data);
    postMessage('Hello, Main Script!');
};
```

## الشرح
### الفخاخ الشائعة
- **عدم تعيين `onmessage`**: إذا لم تقم بتعيين دالة `onmessage`، فلن تتمكن من استقبال الرسائل، مما يؤدي إلى عدم استجابة الـ Worker للرسائل المرسلة.
- **البيانات المعقدة**: عند إرسال كائنات معقدة، تأكد من أن البيانات قابلة للتسلسل (Serializable) لتجنب الأخطاء.
- **الإغلاق المبكر للـ Worker**: إذا تم إغلاق الـ Worker قبل استلام الرسالة، فلن يتم تنفيذ الكود في `onmessage`.

### ملاحظات إضافية
- تأكد من إدارة الأخطاء بشكل صحيح عند التعامل مع الرسائل، حيث يمكن أن تؤدي البيانات غير المتوقعة إلى أعطال.
- يمكنك استخدام `try...catch` للتعامل مع الأخطاء داخل دالة `onmessage`.

## ملخص بجملة واحدة
`onmessage` هو حدث حيوي في جافاسكريبت يُستخدم للتعامل مع التواصل بين الـ Web Workers والصفحة الرئيسية، مما يسهل تبادل البيانات وتنفيذ العمليات المتزامنة.